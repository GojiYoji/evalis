# Evalis Test Cases
# -----------------
# These test cases are shared across all languages to ensure
# consistent implementations.
# -----------------
- expr: foo.bar + 5
  context:
    foo:
      bar: 12
  expected: 17

- expr: foo.baz == true
  context:
    foo:
      baz: true
  expected: true

- expr: "items[1] * 3"
  context:
    items: [2, 4, 6]
  expected: 12

- expr: not (foo.value > 10)
  context:
    foo:
      value: 8
  expected: true

- expr: (x + y) / z
  context:
    x: 6
    y: 3
    z: 3
  expected: 3

- expr: (5 > 10) == false
  expected: true

- expr: ("foo" in items) and all_good
  context:
    all_good: true
    items: ["bar", "juice", "foo"]
  expected: true

- expr: ("foo" in items)
  context:
    all_good: true
    items: ["bar", "juice"]
  expected: false

# List comprehension tests
- expr: "[x * 2 for x in numbers]"
  context:
    numbers: [1, 2, 3]
  expected: [2, 4, 6]

- expr: "[item.name for item in users]"
  context:
    users:
      - name: Alice
      - name: Bob
  expected: ["Alice", "Bob"]

- expr: "[x + 10 for x in values]"
  context:
    values: [5, 15, 25]
  expected: [15, 25, 35]

- expr: "[(x * 2) + 1 for x in numbers]"
  context:
    numbers: [1, 2, 3]
  expected: [3, 5, 7]

- expr: "[item for item in empty]"
  context:
    empty: []
  expected: []

- expr: "[x + offset for x in numbers]"
  context:
    numbers: [1, 2, 3]
    offset: 100
  expected: [101, 102, 103]

- expr: "[user.address.city for user in users]"
  context:
    users:
      - address:
          city: NYC
      - address:
          city: SF
  expected: ["NYC", "SF"]

- expr: "[item[0] for item in matrix]"
  context:
    matrix: [[1, 2], [3, 4], [5, 6]]
  expected: [1, 3, 5]

- expr: "plans['401k']"
  context:
    plans:
      401k: "Hello"
  expected: "Hello"

- expr: test + "abc" + '123'
  context: {}
  expected: abc123
  should_null_on_bad_access: true

- expr: test + "abc" + '123'
  context:
    test: "Hello "
  expected: "Hello abc123"

- expr: '[message + " " + (x * a) for x in items]'
  context:
    a: 100
    items: [1, 2, 3]
    message: "Hello"
  expected: ["Hello 100", "Hello 200", "Hello 300"]

- expr: false + "abc"
  context: {}
  expected: "falseabc"

- expr: 0 + "abc"
  context: {}
  expected: "0abc"

- expr: val + "abc"
  context:
    val: [1, 2, 3]
  expected_error: "Cannot use \\+ operator with types"

- expr: val + val
  context:
    val: [1, 2, 3]
  expected: [1, 2, 3, 1, 2, 3]

# Boolean to string coercion
- expr: true + " test"
  context: {}
  expected: "true test"

# Null handling
- expr: null + null
  context: {}
  expected: null

- expr: null + "test"
  context: {}
  expected: "test"

- expr: '"test" + null'
  context: {}
  expected: "test"

# Dict/object + string should error
- expr: obj + "test"
  context:
    obj:
      foo: "bar"
  expected_error: "Cannot use \\+ operator with types"

# String + array (reverse order, should also error)
- expr: '"test" + arr'
  context:
    arr: [1, 2, 3]
  expected_error: "Cannot use \\+ operator with types"

# Syntax error (tests parseAst error handling)
- expr: "1 +"
  context: {}
  expected_error: "Syntax errors"

# Pass through on boolean value
- expr: "(not has_default_list) and backup_list"
  context:
    has_default_list: true
    backup_list: [1, 2, 3]
  expected: false

- expr: "(not has_default_list) and backup_list"
  context:
    has_default_list: false
    backup_list: [1, 2, 3]
  expected: [1, 2, 3]

# Null coercion for numeric comparisons
- expr: "dne.val > 2"
  context: {}
  expected: false
  should_null_on_bad_access: true

- expr: "dne.val < 2"
  context: {}
  expected: true
  should_null_on_bad_access: true

- expr: "dne.val >= 0"
  context: {}
  expected: true
  should_null_on_bad_access: true

- expr: "dne.val <= 0"
  context: {}
  expected: true
  should_null_on_bad_access: true

- expr: "2 > dne.val"
  context: {}
  expected: true
  should_null_on_bad_access: true

- expr: "dne.a > dne.b"
  context: {}
  expected: false
  should_null_on_bad_access: true

# String comparisons still work
- expr: '"b" > "a"'
  context: {}
  expected: true

- expr: '"apple" < "banana"'
  context: {}
  expected: true

- expr: 'name >= "Alice"'
  context:
    name: "Bob"
  expected: true

# Mixed type comparisons should error
- expr: '5 > "hello"'
  context: {}
  expected_error: "Cannot use > operator with types"

- expr: '"hello" < 10'
  context: {}
  expected_error: "Cannot use < operator with types"
